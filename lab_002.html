<!DOCTYPE html>
<html>
<head>
	<title>lab1-1</title>
	<script type="text/javascript" src="libs/three.js"></script>
	<style type="text/css">
		body{
			margin: 0;
			overflow: hidden; /*设置溢出元素的处理方式*/
		}
	</style>
</head>
<body>
	<div id="WebGL-draw">  
		
	</div>
	<script type="text/javascript">
		var scene, camera, renderer, planeGeometry;
		var flag, lightSphere; 
		/*
		*flag: 表示聚光灯的位置方向
		*lightSphere: 表示聚光灯
		*/
		function init() {
			flag = 0;
			/*创建场景、摄像机、渲染器*/
			scene = new THREE.Scene();
			//scene.fog = new THREE.Fog(0xffffff,5,120); //添加大雾
			//scene.overrideMaterial = new THREE.MeshLambertMaterial({color:0xffff00}); //统一材质
			camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);//设置相机的视椎体
			renderer = new THREE.WebGLRenderer();
			/*设置渲染器*/
			renderer.setClearColor(new THREE.Color(0xEEEEEE));  //设置渲染器背景色
			renderer.setSize(window.innerWidth, window.innerHeight); //设置渲染器大小
			renderer.shadowMapEnabled = true; //开启阴影
			/*添加坐标轴*/
			var axis = new THREE.AxisHelper(50);
			scene.add(axis);
			
			/*创建二维平面*/
			planeGeometry = new THREE.PlaneGeometry(150, 150); //建立180X180的平面
			var planeMaterials = new THREE.MeshLambertMaterial({color: 0xffffff}); //创建暗淡的、无光的材质
			var plane = new THREE.Mesh(planeGeometry, planeMaterials); //构建网格
			plane.receiveShadow = true; //平面接受阴影
			/*修改二维平面*/
			plane.rotation.x = -0.5 * Math.PI;
			plane.position.x = 0;
			plane.position.y = 0;
			plane.position.z = 0;
			/*把平面加入到场景中*/
			scene.add(plane);
			
			
			//创建立方体
			var cubeGeometry = new THREE.CubeGeometry(10,10,10);
			var cubeMaterial = new THREE.MeshLambertMaterial({color:0xff0000});
			var cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
			cube.position.x = 0;
			cube.position.y = 5;
			cube.position.z = 0;
			cube.castShadow = true;
			scene.add(cube);

			/*添加一个聚光灯*/
			var spotColor = "#ffffff";
			var spotLight = new THREE.SpotLight(spotColor);
			//设置聚光灯参数
			spotLight.position.set(30, 30, -10);
			spotLight.castShadow = true;
			spotLight.shadowCameraNear = 1;
			spotLight.shadowCameraFar = 300;
			spotLight.shadowCameraFov = 30;
			spotLight.target = plane;  //设置聚光灯的对象为平面
			spotLight.distance = 0;
			spotLight.shadowCameraVisible = true; //开启聚光灯的绘制框

			scene.add(spotLight);
			
			//创建一个小球，突出光源
			var sphereLight = new THREE.SphereGeometry(0.3);
			var sphereLightMaterial = new THREE.MeshLambertMaterial({color:0xff0000});
			var sphereLightMesh = new THREE.Mesh(sphereLight, sphereLightMaterial);
			//将小球的位置与光源重合
			sphereLightMesh.position.copy(spotLight.position);

			scene.add(sphereLightMesh);
			/*设置摄像机参数*/
			camera.position.x = 50; 
			camera.position.y = 45; 
			camera.position.z = 150;   //调整位置
			camera.lookAt(scene.position); //使相机始终朝向场景
			document.getElementById('WebGL-draw').appendChild(renderer.domElement); 
			//将渲染器画布添加到DOM树中
			/*开始渲染*/
			renderScene();
			function renderScene(){
				//让聚光灯在X轴的（-35，35）之间变化
				if(flag==0 && spotLight.position.x < 35){
					spotLight.position.x += 0.6;
					spotLight.position.z += 0.6;
				}
				if(flag==0 && spotLight.position.x > 35){
					flag = 1;
				}
				if(flag == 1 && spotLight.position.x > -35){
					spotLight.position.x -= 0.6;
					spotLight.position.z -= 0.6;
				}
				if(flag == 1 && spotLight.position.x < -35){
					flag = 0;
				}
				requestAnimationFrame(renderScene); //循环重绘
				renderer.render(scene, camera);
			}
		}
		function onResize(){
			camera.aspect = window.innerWidth / window.innerHeight; //设置相机实际窗口的纵横比
			camera.updateProjectionMatrix();
			renderer.setSize(window.innerWidth, window.innerHeight);
		}
		
		window.onload = init /*设置页面加载*/
		window.addEventListener('resize', onResize, false);
	</script>
</body>
</html>