<!DOCTYPE html>
<html>
<head>
	<title>lab1-1</title>
	<script type="text/javascript" src="libs/three.js"></script>
	<style type="text/css">
		body{
			margin: 0;
			overflow: hidden; /*设置溢出元素的处理方式*/
		}
	</style>
</head>
<body>
	<div id="WebGL-draw">  
		
	</div>
	<script type="text/javascript">
		var scene, camera, renderer, planeGeometry;
		function init() {
			/*创建场景、摄像机、渲染器*/
			scene = new THREE.Scene();
			var scene_002 = new THREE.Scene();
			camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);//设置相机的视椎体
			var camera_002 = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
			/*设置摄像机参数*/
			camera.position.x = 0;
			camera.position.y = 20;
			camera.position.z = 60;   //调整位置
			camera.lookAt(new THREE.Vector3(0,0,0)); //使相机始终朝向场景
			scene.add(camera);
			
			//创建一个WebGLRenderer渲染器
			renderer = new THREE.WebGLRenderer({antialias: true, alpha: true});
        	renderer.setClearColor(new THREE.Color(0xb9b0fe, 1.0));
        	renderer.setSize(window.innerWidth, window.innerHeight);
        	renderer.autoClear = false; 
        	//renderer.shadowMapEnabled = true;
			
			//创建模型
			function createCubeMap(){
				var path = "libs/assets/";
				var format = ".jpg";
				var urls = [
					path + 'posx' + format, path+'negx'+format,
					path + 'posy' + format, path+'negy'+format,
					path + 'posz' + format, path+'negz'+format,
				];
				var textureCube = THREE.ImageUtils.loadTextureCube(urls, new THREE.CubeReflectionMapping());  //加载多材质对象
				return textureCube;
			}
			var textureCube = createCubeMap();
			var shader = THREE.ShaderLib['cube'];
			shader.uniforms["tCube"].value = textureCube;
			var material = new THREE.ShaderMaterial({
				fragmentShader: shader.fragmentShader,
				vertexShader: shader.vertexShader,
				uniforms: shader.uniforms,
				depthWrite: false,
				side: THREE.BackSide
			});
			cubeMesh = new THREE.Mesh(new THREE.BoxGeometry(100,100,100), material);
			scene_002.add(cubeMesh);

			//创建带反光的模型
			function createMesh(geom, texture, normal){
				geom.computeVertexNormals();
				if(normal){
					var texture_map = THREE.ImageUtils.loadTexture("libs/assets/" + texture);
					var normal_map = THREE.ImageUtils.loadTexture("libs/assets/" + normal);
					var mat = new THREE.MeshPhongMaterial({
						map: texture_map, 
						normal: normal_map
					})
					var mesh = new THREE.Mesh(geom, mat);
					return mesh;
				}
				else{
					var texture_map = THREE.ImageUtils.loadTexture("libs/assets/" + texture);
					var mat = new THREE.MeshPhongMaterial({
						map: texture_map
					});
					var mesh = new THREE.Mesh(geom, mat);
					return mesh;
				}
			}
			var sphere = createMesh(new THREE.SphereGeometry(10, 20, 20), "plaster.jpg");
			sphere.material.envMap = textureCube; //指定环境贴图
			sphere.position.x = 15;
			scene.add(sphere);
			var box = createMesh(new THREE.BoxGeometry(10, 15, 15), "plaster.jpg", "plaster-normal.jpg");
			box.material.envMap = textureCube;
			box.position.x = -15;
			scene.add(box);
        	//创建聚光灯
			var directionalLight = new THREE.SpotLight(0xffffff);
        	directionalLight.position.set(0,0,30);
        	directionalLight.intensity = 1;
        	//directionalLight.castShadow = true;
        	scene.add(directionalLight);
        	//增加环境光
        	var ambientLight = new THREE.AmbientLight("#ffffff");
        	scene.add(ambientLight);

			document.getElementById('WebGL-draw').appendChild(renderer.domElement); 
			//将渲染器画布添加到DOM树中
			/*开始渲染*/
			renderScene();
			function renderScene(){
				requestAnimationFrame(renderScene); //循环重绘
				renderer.render(scene_002, camera_002);
				renderer.render(scene, camera);
			}
		}
		function onResize(){
			camera.aspect = window.innerWidth / window.innerHeight; //设置相机实际窗口的纵横比
			camera.updateProjectionMatrix();
			renderer.setSize(window.innerWidth, window.innerHeight);
		}
		
		window.onload = init /*设置页面加载*/
		window.addEventListener('resize', onResize, false);
	</script>
</body>
</html>